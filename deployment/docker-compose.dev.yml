version: '3.8'

# Development-specific overrides for docker-compose.yml
# Run with: docker-compose -f docker-compose.yml -f docker-compose.dev.yml up

services:
  backend:
    build:
      context: ..
      dockerfile: deployment/backend/Dockerfile
      target: development  # If we add a dev stage
    volumes:
      - ../backend:/app/backend  # Read-write for hot reload
      - backend-dev-data:/app/backend/db
    environment:
      - TASKLINE_DEBUG=1
      - PYTHONDONTWRITEBYTECODE=1
    command: ["sh", "-c", "cd backend && alembic upgrade head && cd .. && python -m backend.app"]
    ports:
      - "5001:5001"

  frontend:
    build:
      context: ..
      dockerfile: deployment/frontend/Dockerfile.dev
    volumes:
      - ../frontend:/app  # Hot reload
      - /app/node_modules  # Preserve node_modules
    environment:
      - VITE_API_URL=http://localhost:5001
    ports:
      - "5173:5173"
    command: ["npm", "run", "dev", "--", "--host", "0.0.0.0"]

volumes:
  backend-dev-data:
    name: taskline-backend-dev-data
